try{var d3=require("d3")}catch(t){}var rtVis=function(){function t(t){this._config=t,this.activeArea=t.activeArea,this.activeTime=t.activeTime,this.runDate=t.runDate,this.activeSource=Object.keys(t.rtData)[0],this.activeMapData="Expected change in daily cases",this.downloadUrl=t.downloadUrl,this.ts_color_ref=t.ts_color_ref,Object.values(t.rtData[this.activeSource]).filter(function(t){return null!==t})[0].then?this._requiredData=this.recursiveObjectPromiseAll([{geoData:t.geoData,rtData:t.rtData}]):this._requiredData=Promise.all([{geoData:t.geoData,rtData:t.rtData}]),this._subregional_ref=t.subregional_ref,this.fullWidth=t.fullWidth}return t.prototype.summaryWidget=function(t){this.setupPage(t),this.createMap()},t.prototype.setupFlex=function(l){var c=this.onlyUnique,t=new interact(this._config),p={timeBrush:t.timeBrush.bind(this),dropdownClick:t.dropdownClick.bind(this),sourceSelectClick:t.sourceSelectClick.bind(this)},d=this._config,u=this.activeArea,h=(this.activeTime,this.runDate),y=this.activeSource,m=this.subRegion,f=this.fullWidth,g=this.getDateLims,v=function(t){this.activeTime=t}.bind(this),x=this.downloadUrl,D=this.ts_color_ref;this._requiredData.then(function(t){t=t[0];var e=null;try{t.rtData.Cases.summaryData=t.rtData.Cases.summaryData.map(m),t.rtData.Cases.rtData=t.rtData.Cases.rtData.map(m),t.rtData.Cases.casesInfectionData=t.rtData.Cases.casesInfectionData.map(m),t.rtData.Cases.casesReportData=t.rtData.Cases.casesReportData.map(m),t.rtData.Deaths.summaryData=t.rtData.Deaths.summaryData.map(m),t.rtData.Deaths.rtData=t.rtData.Deaths.rtData.map(m),t.rtData.Deaths.casesInfectionData=t.rtData.Deaths.casesInfectionData.map(m),t.rtData.Deaths.casesReportData=t.rtData.Deaths.casesReportData.map(m)}catch(t){}var a,r,n=new setup(d),i=new ts(d),s=null===t.rtData[y].rtData&&null===t.rtData[y].casesInfectionData&&null===t.rtData[y].casesReportData;s&&null===x||(a=n.setupHeader(l)),s||n.setupDropDown(a),null!==x&&n.setupDownload(a,x,f),null!==t.geoData&&null!==t.rtData[y].summaryData&&n.setupMap(l);try{var o=t.rtData[y].rtData.map(function(t){return t.region}).filter(c).sort()}catch(t){}try{o=t.rtData[y].casesInfectionData.map(function(t){return t.region}).filter(c).sort()}catch(t){}try{o=t.rtData[y].casesReportData.map(function(t){return t.region}).filter(c).sort()}catch(t){}s||($("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select an area",data:o}).on("select2:select",p.dropdownClick),n.setupCountryTitle(l),i.tsCountryTitle(u,"country-title-container")),1<Object.keys(t.rtData).length&&(r=n.setupSourcesHeader(l),n.addSourceSelect(r,"source-select",Object.keys(t.rtData),p.sourceSelectClick,f)),null!==t.rtData[y].rtData&&(n.setupRt(l),e=g(t.rtData[y].rtData,c)),null!==t.rtData[y].casesInfectionData&&(n.setupCasesInfection(l),e=g(t.rtData[y].casesInfectionData,c)),null!==t.rtData[y].casesReportData&&(n.setupCasesReport(l),e=g(t.rtData[y].casesReportData,c)),null===t.rtData[y].rtData&&null===t.rtData[y].casesInfectionData&&null===t.rtData[y].casesReportData||n.setupControls(l,p,e,D),n.setupFooter(l),i.plotAllTs(u,e,t,y,h),v(e)})},t.prototype.getDateLims=function(t,e){var a=d3.timeParse("%Y-%m-%d"),r=t.map(function(t){return t.date}).filter(e).map(function(t){return a(t)});return[d3.min(r),d3.max(r)]},t.prototype.onlyUnique=function(t,e,a){return a.indexOf(t)===e},t.prototype.setupPage=function(t){this.setupFlex(t)},t.prototype.createMap=function(){var t=new interact(this._config),e=this._config,a=t.mapClick.bind(this),r=t.dropdownClick.bind(this),n=t.mapDataClick.bind(this),i=this.activeSource,s=this.activeMapData;this._requiredData.then(function(t){new map(e).setupMap(t[0].geoData,t[0].rtData[i].summaryData,a,r,n,s)})},t.prototype.plotRt=function(t){var e=this._config,a=this.activeArea,r=this.activeTime,n=this.runDate,i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)})},t.prototype.subRegion=function(t){return t.hasOwnProperty("Country")?(t.region=t.Country,delete t.Country):t.hasOwnProperty("country")?(t.region=t.country,delete t.country):t.hasOwnProperty("Region")&&(t.region=t.Region,delete t.Region),t},t.prototype.zipObject=function(t,a){var r={};return t.forEach(function(t,e){r[t]=a[e]}),r},t.prototype.recursiveObjectPromiseAll=function(a){var r=this,e=Object.keys(a);return Promise.all(e.map(function(t){var e=a[t];return"object"!=typeof e||e.then?e:r.recursiveObjectPromiseAll(e)})).then(function(t){return r.zipObject(e,t)})},t}(),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var interact=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.mapClick=function(t){this.activeArea=t.properties.sovereignt;var e=this._config,a=this.activeArea,r=this.activeTime,n=this.runDate,i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)})},t.prototype.mapDataClick=function(){this.activeMapData=d3.select("#map-dataset-item-active").text(),this.createMap()},t.prototype.dropdownClick=function(t){this.activeArea=t.params.data.text;var e=this._config,a=this.activeArea,r=this.activeTime,n=this.runDate,i=this.activeSource;this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)}),d3.select("#select2-dropdown-container-container").text(this.activeArea)},t.prototype.timeBrush=function(t){var e=t,a=this._config,r=this.activeArea,n=this.runDate,i=this.activeSource;this._requiredData.then(function(t){new ts(a).plotAllTs(r,e,t[0],i,n)}),this.activeTime=e},t.prototype.sourceSelectClick=function(t){this.activeSource=d3.select("#source-select :checked").text();var e=this._config,a=this.activeArea,r=this.activeTime,n=this.runDate,i=this.activeSource;this.createMap(),this._requiredData.then(function(t){new ts(e).plotAllTs(a,r,t[0],i,n)})},t}(rtVis),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var setup=function(a){function t(t){var e=a.call(this,t)||this;return e.margin={top:0,right:40,bottom:10,left:10},e}return __extends(t,a),t.prototype.setupCountryTitle=function(t){d3.select(t).append("div").attr("class","country-title-container").attr("id","country-title-container")},t.prototype.setupMap=function(t){d3.select(t).append("div").attr("class","map-container").attr("id","map-container")},t.prototype.setupHeader=function(t){return d3.select(t).append("div").attr("class","dash-header").attr("id","dash-header").style("height","30px").style("width","100%")},t.prototype.setupDropDown=function(t){t.append("div").attr("class","dropdown-container").attr("id","dropdown-container")},t.prototype.setupDownload=function(t,e,a){t.append("div").attr("class","download-container").attr("id","download-container").style("left",a+"px").append("a").attr("href",e).attr("target","_blank").text("Download Data")},t.prototype.setupRt=function(t){d3.select(t).append("div").attr("class","r0-title-container").attr("id","r0-title-container"),d3.select(t).append("div").attr("class","r0-ts-container").attr("id","r0-ts-container")},t.prototype.setupCasesInfection=function(t){d3.select(t).append("div").attr("class","cases-infection-title-container").attr("id","cases-infection-title-container"),d3.select(t).append("div").attr("class","cases-infection-ts-container").attr("id","cases-infection-ts-container")},t.prototype.setupCasesReport=function(t){d3.select(t).append("div").attr("class","cases-report-title-container").attr("id","cases-report-title-container"),d3.select(t).append("div").attr("class","cases-report-ts-container").attr("id","cases-report-ts-container")},t.prototype.setupControls=function(t,e,a,r){d3.select(t).append("div").attr("class","controls-container").attr("id","controls-container"),d3.select("#controls-container").append("div").attr("class","controls-container-legend").attr("id","controls-container-legend"),d3.select("#controls-container").append("div").attr("class","controls-container-time").attr("id","controls-container-time"),d3.select("#controls-container-legend").append("div").text("Legend").attr("class","ts-legend-text").style("font-weight","bold").style("padding-bottom","20px"),d3.select("#controls-container-legend").append("div").attr("id","controls-container-legend-items").attr("class","controls-container-legend-items"),d3.select("#controls-container-legend-items").append("div").attr("class","legend-e").attr("id","legend-e"),d3.select("#controls-container-legend-items").append("div").attr("class","legend-eb").attr("id","legend-eb"),d3.select("#controls-container-legend-items").append("div").attr("class","legend-f").attr("id","legend-f"),d3.select("#legend-e").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-e").style("background-color",r.poly_50_e),d3.select("#legend-e").append("div").text("Estimate").attr("class","ts-legend-text"),d3.select("#legend-eb").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-eb").style("background-color",r.poly_50_eb),d3.select("#legend-eb").append("div").text("Estimate based on partial data").attr("class","ts-legend-text"),d3.select("#legend-f").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-f").style("background-color",r.poly_50_f),d3.select("#legend-f").append("div").text("Forecast").attr("class","ts-legend-text"),this.setupTimeControls(a,"controls-container-time",e.timeBrush)},t.prototype.setupTimeControls=function(r,t,n){d3.select("#"+t).append("div").text("Filter Date").attr("class","ts-legend-text").style("font-weight","bold").style("padding-bottom","10px");var e=document.getElementById(t).getBoundingClientRect();e.width=e.width-this.margin.left-this.margin.right,e.height=e.height-this.margin.top-this.margin.bottom;var a=d3.select("#"+t).append("svg").attr("class",t+"-svg").attr("id",t+"-svg").style("width","100%").style("height","100%").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),i=d3.scaleTime().domain([r[0],r[1]]).range([0,e.width]),s=d3.scaleLinear().domain([0,1]).range([e.height,0]);a.append("g").attr("transform","translate(0,"+e.height+")").call(d3.axisBottom(i).ticks(6).tickSize([0])).attr("class","time-xaxis"),a.append("g").call(d3.axisLeft(s)).attr("class","r0-yaxis").style("display","none");d3.brushX().extent([[this.margin.left,this.margin.top],[e.width-this.margin.right,e.height-this.margin.bottom]]).on("start end",o);function o(t){var e=d3.select(d3.selectAll(".handle--e")._groups[0][0]).attr("x"),a=d3.select(d3.selectAll(".handle--w")._groups[0][0]).attr("x");n(e-a<=4?[r[0],r[1]]:[i.invert(a),i.invert(e)])}a.call(d3.brushX().extent([[0,0],[e.width,e.height]]).on("start brush end",o))},t.prototype.setupFooter=function(t){d3.select(t).append("div").attr("class","footer")},t.prototype.setupSourcesHeader=function(t){return d3.select(t).append("div").attr("class","sources-header").attr("id","sources-header").style("height","25px").style("width","100%")},t.prototype.addSourceSelect=function(t,e,a,r,n){void 0===n&&(n=1e3);for(var i=t.append("div").append("select").attr("class",e).attr("id",e).on("change",r),s=0;s<a.length;s++)i.append("option").text(a[s])},t.prototype.addButtonSpacer=function(t){d3.select(t).append("div").attr("class","button-spacer")},t}(rtVis),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var map=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.setupMap=function(t,a,e,r,n,i){d3.select("#map-svg").remove(),d3.select("#map-container-tooltip").remove(),d3.select("#map-legend").remove();var s=d3.select("#map-container").append("svg").attr("class","map-svg").attr("id","map-svg").style("width","100%").style("height","100%"),o=(d3.select("#map-container").append("div").style("opacity",0).attr("class","tooltip").attr("id","map-container-tooltip"),document.getElementById("map-container").getBoundingClientRect()),l=d3.geoCylindricalStereographic(),c=d3.geoPath().projection(l),p=this.calculateScaleCenter(t,o.width,o.height,c),l=d3.geoCylindricalStereographic().translate([o.width/2,o.height/2]).scale(p.scale).center(p.center);this.projection=l,this.map_svg_dims=o,this.summaryData=a,this.mapDataClick=n;var d,u,c=d3.geoPath().projection(l),h={"Expected change in daily cases":{Decreasing:"#1170aa","Likely decreasing":"#5fa2ce",Unsure:"#7b848f","Likely increasing":"#fd9e49",Increasing:"#e75f00","No Data":"lightgray"},"New confirmed cases by infection date":{"No Data":"lightgray",Numeric:d3.scaleLinear().range(["white","blue"])},"Effective reproduction no.":{"No Data":"lightgray",Numeric:d3.scaleLinear().range(["white","red"])},"Rate of growth":{"No Data":"lightgray",Numeric:d3.scaleLinear().range(["white","green"])},"Doubling/halving time (days)":{"No Data":"lightgray",Numeric:d3.scaleLinear().range(["white","purple"])}},y=this.prepareMapData(a,i);"number"==typeof y[0]?(d=d3.max(y),u=d3.min(y),h[i].Numeric=h[i].Numeric.domain([u,d])):d=u=0;var m=this.parseMapData,f=this.pallette;s.append("g").attr("class","areas").selectAll("path").data(t.features).enter().append("path").attr("class","area-poly").attr("d",c).attr("stroke","white").attr("summary",function(e){try{var t=a.filter(function(t){return t.region==e.properties.sovereignt})[0][i];if("NA"===t)throw"Some summary values are null";return t}catch(t){return"No Data"}}).attr("country-name",function(t){return t.properties.sovereignt}).attr("fill",function(t){return f(m(d3.select(this).attr("summary")),h[i])}).on("mouseenter",this.mapMouseIn.bind(this)).on("mouseout",this.mapMouseOut).on("mouseover",this.mapMouseOver).on("click",e).style("stroke","black").style("stroke-width","0.2px"),this.createLegend(s,o,h[i],i,d,u);var g=t.features.map(function(t){return t.properties.sovereignt}).filter(this.onlyUnique).sort();$("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select an area",data:g}).on("select2:select",r)},t.prototype.prepareMapData=function(t,e){var a=this;return t.map(function(t){return a.parseMapData(t[e])})},t.prototype.parseMapData=function(t){try{return["Decreasing","Likely decreasing","Unsure","Likely increasing","Increasing","No Data"].includes(t)?t:parseFloat(t.split(" ")[0])}catch(t){return"No Data"}},t.prototype.pallette=function(t,e){if("number"!=typeof t)return e[t];try{return e.Numeric(t)}catch(t){return e["No Data"]}},t.prototype.mapMouseIn=function(e){var t=e.geometry.coordinates[0][0].map(function(t){return t[0]}),a=e.geometry.coordinates[0][0].map(function(t){return t[1]}),r=d3.mean(t),n=d3.max(a),i=d3.select("#map-container-tooltip");i.style("opacity",1);var s=this.projection([r,n]),r=s[0]+50,n=s[1]-this.map_svg_dims.height-50;i.style("left",r+"px").style("top",n+"px");var o=this.summaryData.filter(function(t){return t.region==e.properties.sovereignt})[0];try{var l="<b>"+e.properties.sovereignt+": </b>"+Object.keys(o).map(function(t){if("region"!==t)return t+": "+o[t]}).join("</br>")}catch(t){l=""}""===l?i.style("opacity",0):i.html(l)},t.prototype.mapMouseOver=function(t){d3.select(this).style("stroke","black").style("stroke-width","1.5px")},t.prototype.mapMouseOut=function(t){d3.select(this).style("stroke","black").style("stroke-width","0.2px"),d3.select("#map-container-tooltip").style("opacity",0)},t.prototype.createLegend=function(t,e,a,r,n,i){function s(t){t.append("text").text("Legend").attr("x",10+c).attr("y",p-32.5).style("font-size","15px").attr("id","map-legend-title").style("opacity",0).transition().duration(250).style("opacity",1)}function o(t){t.append("text").text("Dataset Selection").attr("x",100+c).attr("y",p-32.5).style("font-size","15px").attr("id","map-legend-data").style("opacity",0).transition().duration(400).style("opacity",1)}function l(t,e,a,r){t.append("line").attr("id","expand-underline").attr("x1",e).attr("x2",e).attr("y1",a).attr("y2",a).style("stroke-width","2.5px").style("stroke","black").transition().duration(250).attr("x1",e-r/2).attr("x2",e+r/2)}var c=e.width/30,p=e.height/2,d=t.append("g").attr("class","map-legend").attr("id","map-legend").on("click",function(t){d3.select("#map-legend-title-sm").empty()?"1"===d3.selectAll("#map-legend-text").style("opacity")?(d3.selectAll("#map-legend-text").style("opacity",0),d3.selectAll("#map-legend-item").style("opacity",0),d3.selectAll("#map-legend-rect").transition().duration(250).attr("width","260px").attr("height","235px"),d3.selectAll("#map-dataset-text").transition().duration(250).delay(100).style("opacity",1),d3.selectAll("#map-dataset-item-active").transition().duration(250).delay(100).style("opacity",1),d3.selectAll("#map-dataset-item").transition().duration(250).delay(100).style("opacity",1),d3.selectAll("#map-dataset-item").style("pointer-events",null),d3.select("#map-legend-title").remove(),d3.select("#map-legend-title-sm").remove(),s(d),d3.select("#map-legend-data").remove(),o(d),d3.select("#map-legend-data").style("font-weight","bold"),d3.select("#expand-underline").remove(),l(d,160+c,p-25,120)):(d3.selectAll("#map-dataset-text").style("opacity",0),d3.selectAll("#map-dataset-item-active").style("opacity",0),d3.selectAll("#map-dataset-item").style("opacity",0),d3.selectAll("#map-legend-rect").transition().duration(250).attr("width","64px").attr("height","25px"),d3.select("#map-legend-title").remove(),d3.select("#map-legend-data").remove(),d3.select("#expand-underline").remove(),d.append("text").text("Legend").attr("x",c-2).attr("y",p-38).style("font-size","14px").attr("id","map-legend-title-sm").style("opacity",0).transition().duration(250).style("opacity",1)):(d3.selectAll("#map-legend-text").transition().duration(250).delay(100).style("opacity",1),d3.selectAll("#map-legend-item").transition().duration(250).delay(100).style("opacity",1),d3.selectAll("#map-legend-rect").transition().duration(250).attr("width","260px").attr("height","235px"),d3.select("#map-legend-title-sm").remove(),d3.select("#map-legend-title").remove(),s(d),d3.select("#map-legend-title").style("font-weight","bold"),d3.select("#map-legend-data").remove(),o(d),d3.select("#expand-underline").remove(),l(d,37+c,p-25,58))});d.append("rect").attr("x",c-10).attr("y",p-55).attr("width","64px").attr("height","25px").attr("class","map-legend-rect").attr("id","map-legend-rect").style("stroke","black").style("fill","white").style("rx","8px"),this.layoutLegend(d,r,a,c,p,200,n,i),this.layoutDatasetSelect(t,d,r,c,p,200)},t.prototype.layoutDatasetSelect=function(t,e,a,r,n,i){var s=e.append("g").attr("id","map-dataset-content").attr("class","map-dataset-content"),o=t.append("g").attr("id","map-dataset-labels").attr("class","map-dataset-labels");s.append("text").text("Dataset Selection").style("font-size","14px").style("padding-top","10px").attr("class","map-dataset-text").attr("id","map-dataset-text").attr("x",r).attr("y",n);for(var l=Object.keys(this.summaryData[0]).filter(function(t){return"region"!==t}),c=0;c<l.length;c++)s.append("rect").attr("x",r).attr("y",n+i/6.5*(c+1)+5-20).attr("rx","15").style("width","240px").style("height","25px").style("fill","lightgrey").attr("class","map-dataset-item").attr("id","map-dataset-item"),o.append("text").attr("x",r+8).attr("y",n+i/6.5*(c+1)+15-14).text(l[c]).style("font-size","12px").style("padding-left","10px").attr("class","map-dataset-item").attr("id","map-dataset-item").on("click",this.mapDataClick).on("mouseenter",function(t){d3.select(this).attr("id","map-dataset-item-active").style("font-weight","bold")}).on("mouseout",function(t){d3.select(this).attr("id","map-dataset-item").style("font-weight","normal")});d3.selectAll("#map-dataset-text").style("opacity",0),d3.selectAll("#map-dataset-item").style("opacity",0),d3.selectAll("#map-dataset-item").style("pointer-events","none")},t.prototype.layoutLegend=function(t,e,a,r,n,i,s,o){var l,c=/\B(?=(\d{3})+(?!\d))/g,p=t.append("g").attr("id","map-legend-content").attr("class","map-legend-content");for(p.append("text").text("Legend").attr("x",r-2).attr("y",n-38).style("font-size","14px").attr("id","map-legend-title-sm"),p.append("text").text(e).style("font-size","14px").style("padding-top","10px").attr("class","map-legend-text").attr("id","map-legend-text").attr("x",r).attr("y",n),l=0<s,u=0;u<Object.entries(a).length;u++){if(l)if(1===u){var d=p.append("defs").append("linearGradient").attr("id","linear-gradient").attr("x1","0%").attr("y1","0%").attr("x2","0%").attr("y2","100%");d.append("stop").attr("offset","0%").attr("stop-color","white"),d.append("stop").attr("offset","100%").attr("stop-color",a.Numeric(s)),p.append("rect").attr("x",r).attr("y",n+i/7*(u+1)+5-20).style("width","12px").style("height","120px").attr("class","map-legend-item").attr("id","map-legend-item").style("fill","url(#linear-gradient)");var u,h=this.legendTicks(o,s,4).concat([s]);for(u=0;u<5;u++)p.append("text").attr("x",r+23).attr("y",n+i/7*(u+1)+20).text((Math.round(100*(h[u]+Number.EPSILON))/100).toString().replace(c,",")).style("font-size","12px").style("padding-left","10px").attr("class","map-legend-item").attr("id","map-legend-item")}else p.append("rect").attr("x",r).attr("y",n+i/7*(u+1)+5-20).style("width","12px").style("height","12px").style("fill",Object.entries(a)[u][1]).attr("class","map-legend-item").attr("id","map-legend-item"),p.append("text").attr("x",r+23).attr("y",n+i/7*(u+1)+15-20).text(Object.entries(a)[u][0]).style("font-size","12px").style("padding-left","10px").attr("class","map-legend-item").attr("id","map-legend-item");else p.append("rect").attr("x",r).attr("y",n+i/7*(u+1)+5-20).style("width","12px").style("height","12px").style("fill",Object.entries(a)[u][1]).attr("class","map-legend-item").attr("id","map-legend-item"),p.append("text").attr("x",r+23).attr("y",n+i/7*(u+1)+15-20).text(Object.entries(a)[u][0]).style("font-size","12px").style("padding-left","10px").attr("class","map-legend-item").attr("id","map-legend-item");d3.selectAll("#map-legend-text").style("opacity",0),d3.selectAll("#map-legend-item").style("opacity",0)}},t.prototype.legendTicks=function(a,t,e){var r=(t-a)/e;return Array.from({length:e},function(t,e){return r*e+a})},t.prototype.calculateScaleCenter=function(t,e,a,r){var n=r.bounds(t),i=120/Math.max((n[1][0]-n[0][0])/e,(n[1][1]-n[0][1])/a),s=d3.geoBounds(t);return{scale:i,center:[(s[1][0]+s[0][0])/2,(s[1][1]+s[0][1])/2]}},t.prototype.onlyUnique=function(t,e,a){return a.indexOf(t)===e},t}(rtVis),__extends=this&&this.__extends||function(){var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var ts=function(a){function t(t){var e=a.call(this,t)||this;return e.margin={top:10,right:30,bottom:30,left:60},e}return __extends(t,a),t.prototype.plotTs=function(i,e,t,s,o,a,l){void 0===a&&(a=void 0),void 0===l&&(l=!1),d3.select("#"+o+"-svg").remove(),d3.select("#"+o+"-tooltip").remove(),i=i.filter(function(t){return t.region==e});try{s=s.filter(function(t){return t.region==e})}catch(t){}try{c=l?null:d3.max(s,function(t){return parseFloat(t.confirm)})}catch(t){var c=null}var p=d3.timeParse("%Y-%m-%d"),r=d3.select("#"+o).append("svg").attr("class",o+"-svg").attr("id",o+"-svg").style("width","100%").style("height","100%").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),d=document.getElementById(o).getBoundingClientRect();d.width=d.width-this.margin.left-this.margin.right,d.height=d.height-this.margin.top-this.margin.bottom;var n,u=d3.min(i.map(function(t){return p(t.date)}));n=t[0]>=u?t[0]:u;var h=t[1];i=(i=i.filter(function(t){return p(t.date)>=n})).filter(function(t){return p(t.date)<=h});try{s=s.filter(function(t){return d3.timeDay.offset(p(t.date),-1)>=n})}catch(t){}if(0!==i.length){try{var y=d3.max(s,function(t){return parseFloat(t.confirm)})}catch(t){}var m=d3.max(i,function(t){return parseFloat(t.upper_90)});if(!l)try{m=this.gt_max_observed_cases(d3.max([m,y]),c)}catch(t){}var f=d3.scaleLinear().domain([0,m]).range([d.height,0]),g=d3.scaleTime().domain([n,h]).range([0,d.width]),v=d3.line().x(function(t){return g(p(t.date))}).y(function(t){return f(1)}).curve(d3.curveCardinal),x=i.filter(function(t){return"estimate"==t.type}),D=i.filter(function(t){return"estimate based on partial data"==t.type}),_=i.filter(function(t){return"forecast"==t.type}),b=this.plotHPoly("date","upper_90","lower_90",g,f,p,c,this.gt_max_observed_cases),w=this.plotHPoly("date","upper_50","lower_50",g,f,p,c,this.gt_max_observed_cases),k=this.plotHPoly("date","upper_20","lower_20",g,f,p,c,this.gt_max_observed_cases);if(!l)try{r.selectAll("rect").data(s).enter().append("rect").attr("x",function(t,e){return g(d3.timeDay.offset(p(t.date),-.5))}).attr("width",function(t){return.8*(g(d3.timeDay.offset(p(t.date),1))-g(p(t.date)))}).attr("height",0).attr("y",d.height).transition().duration(250).delay(function(t,e){return 4*e}).attr("height",function(t,e){return d.height-f(t.confirm)}).attr("y",function(t,e){return f(t.confirm)}).attr("class","cases_bar")}catch(t){}this.addEstimatePolys(r,x,b,"poly_90_e",this.ts_color_ref),this.addEstimatePolys(r,D,b,"poly_90_eb",this.ts_color_ref),this.addEstimatePolys(r,_,b,"poly_90_f",this.ts_color_ref),this.addEstimatePolys(r,x,w,"poly_50_e",this.ts_color_ref),this.addEstimatePolys(r,D,w,"poly_50_eb",this.ts_color_ref),this.addEstimatePolys(r,_,w,"poly_50_f",this.ts_color_ref),this.addEstimatePolys(r,x,k,"poly_20_e",this.ts_color_ref),this.addEstimatePolys(r,D,k,"poly_20_eb",this.ts_color_ref),this.addEstimatePolys(r,_,k,"poly_20_f",this.ts_color_ref),l&&r.append("path").datum(i).attr("d",v).attr("class","r0_line").style("stroke","black").style("stroke-dasharray","5,5"),r.append("g").attr("transform","translate(0,"+d.height+")").call(d3.axisBottom(g)).attr("class","r0-xaxis"),r.append("g").call(d3.axisLeft(f)).attr("class","r0-yaxis"),r.append("line").attr("id",o+"-hover-line").attr("x1",20).attr("y1",0).attr("x2",20).attr("y2",d.height).attr("stroke","black").attr("stroke-width","1px").attr("stroke-opacity",0),void 0!==a&&r.append("line").attr("id","run-date-line").attr("x1",g(p(a))).attr("y1",0).attr("x2",g(p(a))).attr("y2",d.height).attr("stroke","lightgrey").style("stroke-dasharray","5,5");var C=d3.select("#"+o).append("div").style("opacity",0).attr("class","tooltip").attr("id",o+"-tooltip"),A=/\B(?=(\d{3})+(?!\d))/g,S=this.gt_max_observed_cases;r.append("rect").attr("class","overlay").attr("width",d.width).attr("height",d.height).on("mousemove",function(){var e=this;d3.select("#"+o+"-hover-line").attr("x1",d3.mouse(this)[0]).attr("x2",d3.mouse(this)[0]);var t,a=i.filter(function(t){return p(t.date).toDateString()==g.invert(d3.mouse(e)[0]).toDateString()}),r=s.filter(function(t){return p(t.date).toDateString()==g.invert(d3.mouse(e)[0]).toDateString()}),n="<b>"+p(a[0].date).toDateString()+"</b><br>20% CI: "+parseFloat(S(a[0].lower_20,c)).toString().replace(A,",")+" to "+parseFloat(S(a[0].upper_20,c)).toString().replace(A,",")+"<br>50% CI: "+parseFloat(S(a[0].lower_50,c)).toString().replace(A,",")+" to "+parseFloat(S(a[0].upper_50,c)).toString().replace(A,",")+"<br>90% CI: "+parseFloat(S(a[0].lower_90,c)).toString().replace(A,",")+" to "+parseFloat(S(a[0].upper_90,c)).toString().replace(A,",");if(!l)try{n=n+"<br>Confirmed: "+parseFloat(r[0].confirm)}catch(t){}t=d.width-d3.mouse(this)[0]<80?-70:70,C.html(n).style("left",d3.mouse(this)[0]+t+"px").style("top",d3.mouse(this)[1]-200+"px")}).on("mouseenter",function(t){d3.select("#"+o+"-tooltip").style("opacity",1),d3.select("#"+o+"-hover-line").attr("stroke-opacity",1)}).on("mouseout",function(t){d3.select("#"+o+"-tooltip").style("opacity",0),d3.select("#"+o+"-hover-line").attr("stroke-opacity",0)}).attr("fill-opacity","0")}else r.append("text").attr("x",d.width/2).attr("y",d.height/2).text("No data").style("font-size","20px").style("stroke-width",0).style("fill","gray")},t.prototype.addEstimatePolys=function(t,e,a,r,n){t.append("path").datum(e).attr("d",a).attr("class",r).style("fill",n[r]).style("opacity",.5)},t.prototype.plotAllTs=function(t,e,a,r,n){void 0===n&&(n=void 0),this.tsCountryTitle(t,"country-title-container"),null!==a.rtData[r].rtData&&(this.plotTs(a.rtData[r].rtData,t,e,a.rtData[r].obsCasesData,"r0-ts-container",n,!0),this.tsDataTitle("R","r0-title-container")),null!==a.rtData[r].casesInfectionData&&(this.plotTs(a.rtData[r].casesInfectionData,t,e,a.rtData[r].obsCasesData,"cases-infection-ts-container",n,!1),this.tsDataTitle("Cases by date of infection","cases-infection-title-container")),null!==a.rtData[r].casesReportData&&(this.plotTs(a.rtData[r].casesReportData,t,e,a.rtData[r].obsCasesData,"cases-report-ts-container",n,!1),this.tsDataTitle("Cases by date of report","cases-report-title-container"))},t.prototype.tsDataTitle=function(t,e){d3.select("#"+e).text(t)},t.prototype.tsCountryTitle=function(t,e){try{var a=Object.keys(this._subregional_ref).includes(t)?'<a href="'+this._subregional_ref[t]+'" target="_blank" style="font-size:14px;">Detailed estimates available</a>':""}catch(t){}d3.select("#"+e).html(t);try{d3.select("#"+e).append("div").attr("id","subregional-link").html(a)}catch(t){}},t.prototype.plotHPoly=function(e,a,r,n,i,s,o,l){return void 0===s&&(s=null),null!==s?d3.area().x(function(t){return n(s(t[e]))}).y0(function(t){return i(l(t[a],o))}).y1(function(t){return i(l(t[r],o))}):d3.area().x(function(t){return n(t[e])}).y0(function(t){return i(l(t[a],o))}).y1(function(t){return i(l(t[r],o))})},t.prototype.gt_max_observed_cases=function(t,e){return null!==e&&5*e<=t?5*e:t},t}(rtVis);